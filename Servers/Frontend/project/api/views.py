# project/main/views.py


#################
#### imports ####
#################
from flask_login import current_user
from flask_login import login_required
from flask import Flask, jsonify, request, g, url_for, abort, redirect, flash, render_template, Blueprint
from flask_wtf import Form
from werkzeug.utils import secure_filename

################
#### config ####
################

api_blueprint = Blueprint('api', __name__,)


################
#### routes ####
################
@api_blueprint.route('/api/')
def home():
    return render_template('api/api_home.html', current_user=current_user)


@api_blueprint.route('/api/check_whitelist', methods=['POST'])
def check_whitelist():

    sha1 = request.json.get('sha1')
    md5 = request.json.get('md5')
    if sha1 is None or md5 is None:
        abort(400)

    result = {"Found": 0}
    lookup_string = sha1 + ":md5"
    result_string = redis_db.get(lookup_string)
    if result_string is not None:
        if result_string.replace('"', '') == md5:
            result["Found"] = 1

    return jsonify(result)
