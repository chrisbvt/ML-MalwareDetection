import numpy as np
import pandas as pd
import argparse
import glob2

def combine_frames(input_directory, output_file):

    input_directory = input_directory + "*"
    print input_directory
    files = glob2.glob(input_directory)
    total = 0

    if files:
        data_file = open(output_file, 'w+')
        first_chunk = True

        for csv_file in files:
            print "Combining File: %s" % csv_file

            for chunk in pd.read_csv(csv_file, chunksize=5000, error_bad_lines=False):
                total += len(chunk)
                print "Total DataPoints: %d" % total
                if first_chunk:
                    chunk.to_csv(data_file, header=True, mode="a", index_label=False, index=False)
                    first_chunk = False
                else:
                    chunk.to_csv(data_file, header=False, mode="a", index_label=False, index=False)

    return total


def main():
    parser = argparse.ArgumentParser(description="CSV Combiner for Blue Sentry")
    parser.add_argument("--output_file", help="File that the data is output to in csv form", required=True)
    parser.add_argument("--input_directory", help="Directory of Processed CSV Files", required=True)
    args = parser.parse_args()

    data_file = open(args.output_file, 'w+')
    #frames = []
    files = glob2.glob(args.input_directory)

    first_chunk = True
    total = 0
    for csv_file in files:
        print "Combining File: %s" % csv_file

        for chunk in pd.read_csv(csv_file, chunksize=5000, error_bad_lines=False):
            total += len(chunk)
            print "Total DataPoints: %d" % total
            if first_chunk:
                chunk.to_csv(data_file, header=True, mode="a", index_label=False, index=False)
                first_chunk = False
            else:
                chunk.to_csv(data_file, header=False, mode="a", index_label=False, index=False)

    return total


if __name__ == "__main__":
    main()
